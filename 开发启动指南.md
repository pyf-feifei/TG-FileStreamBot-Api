# TG-FileStreamBot å¼€å‘å¯åŠ¨æŒ‡å—

## ğŸ“‹ å‰ç½®è¦æ±‚

### 1. ç¯å¢ƒå‡†å¤‡

```bash
- Go 1.21+
- Git
- SOCKS5ä»£ç†ï¼ˆå¼€å‘ç¯å¢ƒå¿…éœ€ï¼Œå¦‚Clash/V2Rayï¼‰
```

### 2. Telegram é…ç½®

ä» [https://my.telegram.org/apps](https://my.telegram.org/apps) è·å–ï¼š

- `API_ID`
- `API_HASH`
- `BOT_TOKEN` (ä» @BotFather è·å–)
- `LOG_CHANNEL` (åˆ›å»ºä¸€ä¸ªç§æœ‰é¢‘é“ï¼Œè·å–é¢‘é“ ID)

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆ3 æ­¥ï¼‰

### æ­¥éª¤ 1ï¼šå…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd TG-FileStreamBot
```

### æ­¥éª¤ 2ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
copy fsb.sample.env fsb.env

# ç¼–è¾‘ fsb.envï¼Œå¡«å†™å¿…éœ€é…ç½®ï¼š
API_ID=ä½ çš„API_ID
API_HASH=ä½ çš„API_HASH
BOT_TOKEN=ä½ çš„BOT_TOKEN
LOG_CHANNEL=ä½ çš„é¢‘é“ID

# å¼€å‘æ¨¡å¼é…ç½®
DEV=true
TELEGRAM_PROXY=socks5://127.0.0.1:7890  # ä½ çš„ä»£ç†åœ°å€
```

### æ­¥éª¤ 3ï¼šå¯åŠ¨æœåŠ¡

```bash
# æ–¹å¼1ï¼šç›´æ¥è¿è¡Œï¼ˆéœ€å…ˆç¼–è¯‘ï¼‰
go build -o fsb.exe ./cmd/fsb
.\fsb.exe run --dev

# æ–¹å¼2ï¼šä½¿ç”¨go run
go run ./cmd/fsb run --dev
```

---

## ğŸ”§ å®Œæ•´é…ç½®è¯´æ˜

### å¿…éœ€é…ç½®

```bash
# ===== Telegram é…ç½® =====
API_ID=25384994                    # ä» my.telegram.org è·å–
API_HASH=your_api_hash             # ä» my.telegram.org è·å–
BOT_TOKEN=123456:ABC-DEF           # ä» @BotFather è·å–
LOG_CHANNEL=-1001234567890         # é¢‘é“IDï¼ˆè´Ÿæ•°ï¼‰

# ===== å¼€å‘æ¨¡å¼ =====
DEV=true                           # å¯ç”¨å¼€å‘æ¨¡å¼
```

### ä»£ç†é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒå¿…éœ€ï¼‰

```bash
# ===== SOCKS5ä»£ç† =====
TELEGRAM_PROXY=socks5://127.0.0.1:7890

# å¸¸ç”¨ä»£ç†ç«¯å£ï¼š
# Clash: 7890
# V2Ray: 1080
# Shadowsocks: 1080
```

### ä¸Šä¼ åŠŸèƒ½é…ç½®ï¼ˆå¯é€‰ï¼‰

```bash
# ===== HTTPä¸Šä¼ API =====
ENABLE_UPLOAD_API=true
UPLOAD_AUTH_TOKEN=your-secret-token

# æ–‡ä»¶é™åˆ¶
MAX_FILE_SIZE=209715200            # 200MB
# USER_QUOTA=0                     # 0æˆ–ä¸è®¾ç½®=ä¸é™åˆ¶

# å…è®¸çš„æ–‡ä»¶ç±»å‹
ALLOWED_MIME_TYPES=image/jpeg,image/png,image/gif,video/mp4,text/plain,application/pdf
ALLOWED_EXTENSIONS=.jpg,.jpeg,.png,.gif,.mp4,.txt,.pdf

# é€Ÿç‡é™åˆ¶
UPLOADS_PER_MINUTE=15              # æ¯åˆ†é’Ÿ15æ¬¡
UPLOADS_PER_HOUR=300               # æ¯å°æ—¶300æ¬¡
CONCURRENT_UPLOADS_PER_USER=3      # å¹¶å‘3ä¸ª
API_COOLDOWN_SECONDS=4             # å†·å´4ç§’
```

### æ€§èƒ½ä¼˜åŒ–é…ç½®ï¼ˆå¯é€‰ï¼‰

```bash
# ===== å¤šBot Tokenï¼ˆæå‡å¹¶å‘èƒ½åŠ›ï¼‰ =====
MULTI_TOKEN1=bot1_token
MULTI_TOKEN2=bot2_token
MULTI_TOKEN3=bot3_token
MULTI_TOKEN4=bot4_token
```

---

## ğŸ“ å¯åŠ¨æ­¥éª¤è¯¦è§£

### 1. å®‰è£…ä¾èµ–

```bash
# æ‹‰å–ä¾èµ–åŒ…
go mod download

# æˆ–è€…æ„å»ºæ—¶è‡ªåŠ¨ä¸‹è½½
go build -o fsb.exe ./cmd/fsb
```

### 2. éªŒè¯é…ç½®

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
dir fsb.env

# æŸ¥çœ‹é…ç½®å†…å®¹ï¼ˆä¸è¦æ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼‰
type fsb.env
```

### 3. å¯åŠ¨ä»£ç†ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

```bash
# ç¡®ä¿ä»£ç†æ­£åœ¨è¿è¡Œ
# Clash: æ‰“å¼€Clashåº”ç”¨
# V2Ray: å¯åŠ¨v2rayæœåŠ¡

# æµ‹è¯•ä»£ç†è¿æ¥
curl --socks5 127.0.0.1:7890 https://api.telegram.org/bot<YOUR_TOKEN>/getMe
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# PowerShell
.\fsb.exe run --dev

# æˆ–ä½¿ç”¨ CMD
fsb.exe run --dev

# æˆ–ç›´æ¥ç¼–è¯‘è¿è¡Œ
go run ./cmd/fsb run --dev
```

### 5. éªŒè¯å¯åŠ¨æˆåŠŸ

```bash
# æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
âœ“ SOCKS5ä»£ç†å·²é…ç½®
âœ“ Client started {"username": "your_bot_name"}
âœ“ Server is running at http://localhost:8080
```

---

## ğŸ§ª æµ‹è¯•æœåŠ¡

### 1. æµ‹è¯• HTTP æœåŠ¡å™¨

```bash
# PowerShell
Invoke-RestMethod http://localhost:8080/

# æˆ–ä½¿ç”¨ curl
curl http://localhost:8080/
```

### 2. æµ‹è¯•ä¸Šä¼  APIï¼ˆéœ€è¦è®¤è¯ï¼‰

```bash
# æŸ¥è¯¢é…é¢çŠ¶æ€
curl http://localhost:8080/upload/status ^
  -H "Authorization: Bearer your-secret-token"

# ä¸Šä¼ æ–‡ä»¶
curl -X POST http://localhost:8080/upload ^
  -H "Authorization: Bearer your-secret-token" ^
  -F "file=@test.jpg;type=image/jpeg"
```

### 3. æµ‹è¯•æµåª’ä½“

```bash
# ä¸Šä¼ æˆåŠŸåä¼šè¿”å›streamUrl
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š
http://localhost:8080/stream/123?hash=xxx
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šTelegram è¿æ¥è¶…æ—¶

```
ERROR: Failed to start main bot {"error": "context deadline exceeded"}
```

**åŸå› **ï¼šä»£ç†æœªé…ç½®æˆ–æ— æ•ˆ

**è§£å†³**ï¼š

1. æ£€æŸ¥ `fsb.env` ä¸­ `TELEGRAM_PROXY` æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ä»£ç†æœåŠ¡æ­£åœ¨è¿è¡Œ
3. æµ‹è¯•ä»£ç†è¿æ¥ï¼š

   ```bash
   curl --socks5 127.0.0.1:7890 https://api.telegram.org
   ```

### é—®é¢˜ 2ï¼šä¸Šä¼ å¤±è´¥ (MIME ç±»å‹é”™è¯¯)

```
{"code":400,"error":"ä¸å…è®¸çš„MIMEç±»å‹: application/octet-stream"}
```

**åŸå› **ï¼šcurl æœªæŒ‡å®šæ–‡ä»¶ç±»å‹

**è§£å†³**ï¼šæ˜¾å¼æŒ‡å®š MIME ç±»å‹

```bash
# âœ… æ­£ç¡®
curl -F "file=@video.mp4;type=video/mp4" ...

# âŒ é”™è¯¯
curl -F "file=@video.mp4" ...
```

### é—®é¢˜ 3ï¼šç«¯å£è¢«å ç”¨

```
ERROR: listen tcp :8080: bind: address already in use
```

**è§£å†³**ï¼š

```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
netstat -ano | findstr :8080

# ç»“æŸè¿›ç¨‹ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
taskkill /F /PID <è¿›ç¨‹ID>

# æˆ–ä¿®æ”¹ç«¯å£ï¼ˆfsb.envï¼‰
PORT=8081
```

### é—®é¢˜ 4ï¼šæ‰¾ä¸åˆ° fsb.exe

```bash
# ç¡®ä¿å·²ç¼–è¯‘
go build -o fsb.exe ./cmd/fsb

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
dir fsb.exe
```

---

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### æ—¥å¸¸å¼€å‘æµç¨‹

```bash
# 1. åœæ­¢æ—§æœåŠ¡
Get-Process fsb -ErrorAction SilentlyContinue | Stop-Process -Force

# 2. ä¿®æ”¹ä»£ç 
# ...ç¼–è¾‘ä»£ç ...

# 3. é‡æ–°ç¼–è¯‘
go build -o fsb.exe ./cmd/fsb

# 4. å¯åŠ¨æµ‹è¯•
.\fsb.exe run --dev

# 5. æŸ¥çœ‹æ—¥å¿—
Get-Content test.log -Tail 20 -Wait
```

### å¿«é€Ÿé‡å¯è„šæœ¬ï¼ˆPowerShellï¼‰

```powershell
# ä¿å­˜ä¸º restart.ps1
Get-Process fsb -ErrorAction SilentlyContinue | Stop-Process -Force
Start-Sleep -Seconds 1
go build -o fsb.exe ./cmd/fsb
if ($?) {
    Write-Host "âœ“ ç¼–è¯‘æˆåŠŸ" -ForegroundColor Green
    .\fsb.exe run --dev
}
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. æå‡ä¸Šä¼ å¹¶å‘ï¼ˆå¤š Tokenï¼‰

```bash
# fsb.env
MULTI_TOKEN1=bot1_token
MULTI_TOKEN2=bot2_token
MULTI_TOKEN3=bot3_token
MULTI_TOKEN4=bot4_token

# æ•ˆæœï¼š
# - ä¸Šä¼ å¹¶å‘ï¼š4å€
# - é€Ÿç‡é™åˆ¶ï¼š4Ã—20æ¡/åˆ†é’Ÿ = 80æ¡/åˆ†é’Ÿ
```

### 2. è°ƒæ•´é€Ÿç‡é™åˆ¶

```bash
# ä¿å®ˆé…ç½®ï¼ˆé«˜ç¨³å®šï¼‰
UPLOADS_PER_MINUTE=10
API_COOLDOWN_SECONDS=6

# å¹³è¡¡é…ç½®ï¼ˆæ¨èï¼‰
UPLOADS_PER_MINUTE=15
API_COOLDOWN_SECONDS=4

# æ¿€è¿›é…ç½®ï¼ˆè¿½æ±‚æ€§èƒ½ï¼‰
UPLOADS_PER_MINUTE=18
API_COOLDOWN_SECONDS=3
```

### 3. å¢åŠ æ–‡ä»¶å¤§å°é™åˆ¶

```bash
# æ”¹ä¸º2GBï¼ˆTelegramæœ€å¤§æ”¯æŒï¼‰
MAX_FILE_SIZE=2147483648
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

```bash
# ä¿®æ”¹ä»£ç æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡
LOG_LEVEL=debug .\fsb.exe run --dev
```

### 2. æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# PowerShell
Get-Content test.log -Wait -Tail 50

# æˆ–ä½¿ç”¨ CMD
tail -f test.log
```

### 3. æµ‹è¯•å•ä¸ªåŠŸèƒ½

```go
// è¿è¡Œç‰¹å®šæµ‹è¯•
go test ./internal/routes -v -run TestUploadHandler

// è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test ./... -v
```

---

## ğŸ“¦ éƒ¨ç½²å‡†å¤‡

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```bash
# fsb.envï¼ˆç”Ÿäº§ï¼‰
DEV=false                          # å…³é—­å¼€å‘æ¨¡å¼
# TELEGRAM_PROXY=                  # ä¸ä½¿ç”¨ä»£ç†ï¼ˆç›´è¿ï¼‰
PORT=8080
HOST=https://your-domain.com

# å®‰å…¨é…ç½®
UPLOAD_AUTH_TOKEN=<å¼ºå¯†ç >         # ä½¿ç”¨å¤æ‚å¯†ç 
MAX_FILE_SIZE=2147483648           # 2GB
USER_QUOTA=10737418240             # 10GBé™åˆ¶

# é€Ÿç‡é™åˆ¶ï¼ˆæ›´ä¸¥æ ¼ï¼‰
UPLOADS_PER_MINUTE=5
UPLOADS_PER_HOUR=50
API_COOLDOWN_SECONDS=5
```

### ç¼–è¯‘ä¼˜åŒ–

```bash
# ç¼–è¯‘å‘å¸ƒç‰ˆï¼ˆä¼˜åŒ–æ€§èƒ½ï¼‰
go build -ldflags="-s -w" -o fsb ./cmd/fsb

# äº¤å‰ç¼–è¯‘ï¼ˆLinuxï¼‰
GOOS=linux GOARCH=amd64 go build -o fsb ./cmd/fsb
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“„ `ä¸Šä¼ APIä½¿ç”¨è¯´æ˜.md` - API æ¥å£æ–‡æ¡£
- ğŸ“„ `ä»£ç†é…ç½®è¯´æ˜.md` - ä»£ç†é…ç½®è¯¦è§£
- ğŸ“„ `é¡¹ç›®å¼€å‘è®°å½•.md` - å¼€å‘å†å²å’Œå†³ç­–
- ğŸ“„ `å¯åŠ¨è¯´æ˜.md` - é—®é¢˜æ’æŸ¥æŒ‡å—

---

## ğŸ†˜ è·å–å¸®åŠ©

### æŸ¥çœ‹å¸®åŠ©å‘½ä»¤

```bash
.\fsb.exe --help
.\fsb.exe run --help
```

### æ£€æŸ¥é…ç½®

```bash
# éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
go run ./cmd/fsb run --dev --dry-run
```

### å¸¸ç”¨è¯Šæ–­å‘½ä»¤

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :8080

# æŸ¥çœ‹è¿›ç¨‹
Get-Process fsb

# æµ‹è¯•Telegramè¿æ¥
curl --socks5 127.0.0.1:7890 https://api.telegram.org/bot<TOKEN>/getMe
```

---

## âœ… å¯åŠ¨æ£€æŸ¥æ¸…å•

åœ¨å¯åŠ¨å‰ç¡®ä¿ï¼š

- [ ] Go ç¯å¢ƒå·²å®‰è£…ï¼ˆ`go version`ï¼‰
- [ ] ä»£ç†æ­£åœ¨è¿è¡Œï¼ˆClash/V2Rayï¼‰
- [ ] `fsb.env` å·²é…ç½®ï¼ˆAPI_ID, API_HASH, BOT_TOKENï¼‰
- [ ] ä»£ç†åœ°å€æ­£ç¡®ï¼ˆTELEGRAM_PROXYï¼‰
- [ ] ç«¯å£ 8080 æœªè¢«å ç”¨
- [ ] LOG_CHANNEL å·²åˆ›å»ºå¹¶è·å– ID

å¯åŠ¨åéªŒè¯ï¼š

- [ ] æ—¥å¿—æ˜¾ç¤º"SOCKS5 ä»£ç†å·²é…ç½®"
- [ ] æ—¥å¿—æ˜¾ç¤º"Client started"
- [ ] æ—¥å¿—æ˜¾ç¤º"Server is running"
- [ ] `curl http://localhost:8080/` è¿”å›çŠ¶æ€
- [ ] ä¸Šä¼ æµ‹è¯•æˆåŠŸ

---

**ğŸ‰ å®Œæˆï¼ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹å¼€å‘äº†ï¼**

å¦‚é‡é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ `å¯åŠ¨è¯´æ˜.md`ï¼ˆé—®é¢˜æ’æŸ¥ï¼‰æˆ–æäº¤ Issueã€‚
